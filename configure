#!/usr/bin/env bash

# Default configuration
prefix=/usr/local/
mozpluginpath=/usr/lib/mozilla/plugins
gccruntimedlls=/usr/lib/gcc/i686-w64-mingw32/4.6/
winepath=/opt/wine-compholio/bin/wine

usage ()
{
	echo ""
	echo "Usage: ./configure [--prefix=PREFIX] [--wine-path=PATH] [--moz-plugin-path=PATH] [--gcc-runtime-dlls=PATH]"
	echo ""
}

while [[ $# > 0 ]] ; do
	CMD="$1"; shift
	case "$CMD" in
		--prefix=*)
			prefix=${CMD#*=}
			;;
		--prefix)
			prefix="$1"; shift
			;;

		--wine-path=*)
			winepath=${CMD#*=}
			;;
		--wine-path)
			winepath="$1"; shift
			;;

		--moz-plugin-path=*)
			mozpluginpath=${CMD#*=}
			;;
		--moz-plugin-path)
			mozpluginpath="$1"; shift
			;;

		--gcc-runtime-dlls=*)
			gccruntimedlls=${CMD#*=}
			;;
		--gcc-runtime-dlls)
			gccruntimedlls="$1"; shift
			;;

		--help)
			usage
			exit
			;;
		*)
			echo "WARNING: Unknown argument $CMD." >&2
			;;
	esac
done

# Normalize the path
prefix=$(readlink -m "$prefix")

echo "Configuration Summary"
echo "---------------------"
echo ""
echo "Pipelight has been configured with"
echo "  prefix        = '$prefix'"
echo "  winepath      = '$winepath'"
echo "  mozpluginpath = '$mozpluginpath'"
echo " gccruntimedlls = '$gccruntimedlls'"
echo ""
echo "IMPORTANT: Please ensure you have XATTR support enabled for both wine and"
echo "           your file system (required to watch DRM protected content)!"
echo ""

echo "prefix=$prefix" 					>  config.make
echo "winepath=$winepath"				>> config.make
echo "mozpluginpath=$mozpluginpath"		>> config.make
echo "gccruntimedlls=$gccruntimedlls"	>> config.make
exit 0