From 03d6a0ed36530de2f98625827341ec7349fddacd Mon Sep 17 00:00:00 2001
From: Andreas Loibl <andreas@andreas-loibl.de>
Date: Sat, 7 Sep 2013 14:44:35 +0200
Subject: oleaut32: Implementation of VarDecRound

---
 dlls/oleaut32/vartype.c |   10 ++++++++--
 1 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/dlls/oleaut32/vartype.c b/dlls/oleaut32/vartype.c
index 74f66de..2f89c5c 100644
--- a/dlls/oleaut32/vartype.c
+++ b/dlls/oleaut32/vartype.c
@@ -5765,6 +5765,8 @@ HRESULT WINAPI VarDecNeg(const DECIMAL* pDecIn, DECIMAL* pDecOut)
  */
 HRESULT WINAPI VarDecRound(const DECIMAL* pDecIn, int cDecimals, DECIMAL* pDecOut)
 {
+  HRESULT hRet = S_OK;
+
   if (cDecimals < 0 || (DEC_SIGN(pDecIn) & ~DECIMAL_NEG) || DEC_SCALE(pDecIn) > DEC_MAX_SCALE)
     return E_INVALIDARG;
 
@@ -5774,9 +5776,13 @@ HRESULT WINAPI VarDecRound(const DECIMAL* pDecIn, int cDecimals, DECIMAL* pDecOu
     return S_OK;
   }
 
-  FIXME("semi-stub!\n");
+  /* Multiply with 10^cDecimals, round to Int, divide by 10^cDecimals */
+  *pDecOut = *pDecIn;
+  DEC_SCALE(pDecOut) -= cDecimals; /* scale-- equals value*=10 */
+  hRet = VarDecInt(pDecOut, pDecOut);
+  DEC_SCALE(pDecOut) += cDecimals; /* scale++ equals value/=10 */
 
-  return DISP_E_OVERFLOW;
+  return hRet;
 }
 
 /************************************************************************
-- 
1.7.2.5

